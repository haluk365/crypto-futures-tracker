<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Binance Futures √áoklu Takip√ßi</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            padding: 2rem;
            color: white;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        .header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            text-align: center;
        }
        h1 {
            margin-bottom: 1.5rem;
            font-size: 2.5rem;
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .add-coin { display: flex; gap: 10px; max-width: 400px; margin: 0 auto; }
        input {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 16px;
        }
        input::placeholder { color: rgba(255, 255, 255, 0.7); }
        input:focus { outline: none; background: rgba(255, 255, 255, 0.3); }
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            cursor: pointer;
            font-weight: bold;
        }
        button:hover { transform: translateY(-2px); }
        .table-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 1.5rem;
            overflow-x: auto;
        }
        .coins-table { width: 100%; border-collapse: collapse; }
        .coins-table th {
            background: rgba(255, 255, 255, 0.1);
            padding: 1rem;
            text-align: left;
            color: #ffd700;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
        }
        .coins-table td { padding: 1rem; border-bottom: 1px solid rgba(255, 255, 255, 0.1); }
        .coins-table tr:hover { background: rgba(255, 255, 255, 0.05); }
        .coin-name { font-size: 1.1rem; font-weight: bold; color: #ffd700; }
        .status {
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: bold;
            text-align: center;
            min-width: 60px;
            display: inline-block;
        }
        .status.connected { background: rgba(0, 255, 136, 0.2); color: #00ff88; }
        .status.disconnected { background: rgba(255, 71, 87, 0.2); color: #ff4757; }
        .status.connecting { background: rgba(255, 215, 0, 0.2); color: #ffd700; }
        .price { font-size: 1.3rem; font-weight: bold; font-family: monospace; }
        .price.up { color: #00ff88; }
        .price.down { color: #ff4757; }
        .change-positive { color: #00ff88; font-weight: bold; }
        .change-negative { color: #ff4757; font-weight: bold; }
        .remove-btn {
            background: linear-gradient(45deg, #ff4757, #c44569);
            padding: 6px 12px;
            font-size: 11px;
            border: none;
            border-radius: 6px;
            color: white;
            cursor: pointer;
        }
        .numeric-cell { text-align: right; font-family: monospace; }
        .no-coins { text-align: center; padding: 3rem; opacity: 0.7; font-size: 1.2rem; }
        .sortable { cursor: pointer; user-select: none; position: relative; }
        .sortable:hover { background: rgba(255, 255, 255, 0.2); }
        .sortable::after { content: '‚ÜïÔ∏è'; position: absolute; right: 5px; opacity: 0.5; }
        .sortable.asc::after { content: '‚Üë'; opacity: 1; color: #00ff88; }
        .sortable.desc::after { content: '‚Üì'; opacity: 1; color: #ff4757; }
        @media (max-width: 768px) {
            body { padding: 1rem; }
            h1 { font-size: 2rem; }
            .add-coin { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Binance Futures √áoklu Takip√ßi</h1>
            <div class="add-coin">
                <input type="text" id="coinInput" placeholder="Coin adƒ± (√∂rn: BTC)">
                <button onclick="addCoin()">Ekle</button>
            </div>
        </div>
        <div class="table-container" id="container">
            <div class="no-coins">Takip etmek istediƒüiniz coinleri yukarƒ±dan ekleyin</div>
        </div>
    </div>

    <script>
        let coins = {};
        let sortData = { col: null, dir: 'asc' };

        function $(id) { return document.getElementById(id); }
        
        function formatPrice(p) {
            const n = parseFloat(p);
            if (n >= 1) return '$' + n.toFixed(2);
            if (n >= 0.01) return '$' + n.toFixed(4);
            return '$' + n.toFixed(8);
        }

        function formatNum(n) {
            if (n >= 1000000) return (n / 1000000).toFixed(2) + 'M';
            if (n >= 1000) return (n / 1000).toFixed(2) + 'K';
            return parseFloat(n).toFixed(2);
        }

        function formatFunding(r) {
            if (!r) return '-';
            const p = (parseFloat(r) * 100).toFixed(4);
            return (p >= 0 ? '+' : '') + p + '%';
        }

        async function getFunding(s) {
            try {
                const res = await fetch(`https://fapi.binance.com/fapi/v1/premiumIndex?symbol=${s}`);
                const data = await res.json();
                return data.lastFundingRate;
            } catch (e) {
                return null;
            }
        }

        function save() {
            localStorage.setItem('coins', JSON.stringify(Object.keys(coins)));
        }

        function load() {
            const saved = localStorage.getItem('coins');
            if (saved) {
                JSON.parse(saved).forEach(s => {
                    coins[s] = { ws: null, last: 0 };
                });
                return Object.keys(coins).length > 0;
            }
            return false;
        }

        function updateStatus(s, msg, type) {
            const el = $(`status-${s}`);
            if (el) {
                el.textContent = msg;
                el.className = `status ${type}`;
            }
        }

        function connect(s) {
            const ws = new WebSocket(`wss://fstream.binance.com/ws/${s.toLowerCase()}@ticker`);
            coins[s].ws = ws;

            getFunding(s).then(r => {
                const el = $(`funding-${s}`);
                if (el) {
                    el.textContent = formatFunding(r);
                    el.className = `numeric-cell ${parseFloat(r || 0) >= 0 ? 'change-positive' : 'change-negative'}`;
                }
            });

            ws.onopen = () => updateStatus(s, 'Baƒülƒ±', 'connected');
            ws.onerror = () => updateStatus(s, 'Hata', 'disconnected');
            ws.onclose = () => updateStatus(s, 'Kesildi', 'disconnected');
            
            ws.onmessage = (e) => {
                try {
                    const d = JSON.parse(e.data);
                    const price = parseFloat(d.c);
                    const change = parseFloat(d.P);
                    
                    const priceEl = $(`price-${s}`);
                    if (priceEl) {
                        priceEl.textContent = formatPrice(d.c);
                        priceEl.className = 'price';
                        if (price > coins[s].last) priceEl.classList.add('up');
                        else if (price < coins[s].last) priceEl.classList.add('down');
                    }

                    const changeEl = $(`change-${s}`);
                    if (changeEl) {
                        changeEl.textContent = `${change >= 0 ? '+' : ''}${change.toFixed(2)}%`;
                        changeEl.className = `numeric-cell ${change >= 0 ? 'change-positive' : 'change-negative'}`;
                    }

                    const highEl = $(`high-${s}`);
                    const lowEl = $(`low-${s}`);
                    const volEl = $(`vol-${s}`);

                    if (highEl) highEl.textContent = formatPrice(d.h);
                    if (lowEl) lowEl.textContent = formatPrice(d.l);
                    if (volEl) volEl.textContent = formatNum(d.v);

                    coins[s].last = price;
                } catch (err) {
                    console.error('Parse error:', err);
                }
            };
        }

        function createTable() {
            return `
                <table class="coins-table">
                    <thead>
                        <tr>
                            <th class="sortable" onclick="sort('coin')">Sembol</th>
                            <th>Durum</th>
                            <th class="sortable" onclick="sort('price')">Fiyat</th>
                            <th class="sortable" onclick="sort('change')">24s %</th>
                            <th class="sortable" onclick="sort('funding')">Fund</th>
                            <th class="sortable" onclick="sort('high')">24s Y√ºksek</th>
                            <th class="sortable" onclick="sort('low')">24s D√º≈ü√ºk</th>
                            <th class="sortable" onclick="sort('vol')">Hacim</th>
                            <th>ƒ∞≈ülem</th>
                        </tr>
                    </thead>
                    <tbody id="tbody"></tbody>
                </table>
            `;
        }

        function createRow(s) {
            return `
                <tr id="row-${s}">
                    <td><div class="coin-name">${s}</div></td>
                    <td><span class="status connecting" id="status-${s}">Baƒülanƒ±yor...</span></td>
                    <td class="numeric-cell"><div class="price" id="price-${s}">$0.00</div></td>
                    <td class="numeric-cell" id="change-${s}">-</td>
                    <td class="numeric-cell" id="funding-${s}">-</td>
                    <td class="numeric-cell" id="high-${s}">-</td>
                    <td class="numeric-cell" id="low-${s}">-</td>
                    <td class="numeric-cell" id="vol-${s}">-</td>
                    <td><button class="remove-btn" onclick="remove('${s}')">Kaldƒ±r</button></td>
                </tr>
            `;
        }

        function updateUI() {
            const container = $('container');
            const count = Object.keys(coins).length;

            if (count === 0) {
                container.innerHTML = '<div class="no-coins">Takip etmek istediƒüiniz coinleri yukarƒ±dan ekleyin</div>';
            } else {
                if (!$('tbody')) {
                    container.innerHTML = createTable();
                }
                
                const tbody = $('tbody');
                Object.keys(coins).forEach(s => {
                    if (!$(`row-${s}`)) {
                        tbody.innerHTML += createRow(s);
                    }
                });
            }
        }

        function sort(col) {
            const tbody = $('tbody');
            if (!tbody) return;

            // Sƒ±ralama y√∂n√ºn√º belirle
            if (sortData.col === col) {
                sortData.dir = sortData.dir === 'asc' ? 'desc' : 'asc';
            } else {
                sortData.col = col;
                sortData.dir = 'asc';
            }

            // Ba≈ülƒ±k stillerini temizle
            document.querySelectorAll('.sortable').forEach(th => {
                th.classList.remove('asc', 'desc');
            });

            // Aktif ba≈ülƒ±ƒüƒ± i≈üaretle
            const headers = document.querySelectorAll('.sortable');
            headers.forEach(th => {
                const onclick = th.getAttribute('onclick');
                if (onclick && onclick.includes(`'${col}'`)) {
                    th.classList.add(sortData.dir);
                }
            });

            // Satƒ±rlarƒ± al ve sƒ±rala
            const rows = Array.from(tbody.children);
            
            rows.sort((rowA, rowB) => {
                let valueA, valueB;
                
                // Coin ismi i√ßin string kar≈üƒ±la≈ütƒ±rma
                if (col === 'coin') {
                    valueA = rowA.cells[0].textContent.trim();
                    valueB = rowB.cells[0].textContent.trim();
                    const result = valueA.localeCompare(valueB);
                    return sortData.dir === 'asc' ? result : -result;
                }
                
                // Diƒüer s√ºtunlar i√ßin sayƒ±sal kar≈üƒ±la≈ütƒ±rma
                let cellIndex;
                switch(col) {
                    case 'price': cellIndex = 2; break;
                    case 'change': cellIndex = 3; break;
                    case 'funding': cellIndex = 4; break;
                    case 'high': cellIndex = 5; break;
                    case 'low': cellIndex = 6; break;
                    case 'vol': cellIndex = 7; break;
                    default: return 0;
                }
                
                // H√ºcre deƒüerlerini al ve temizle
                const textA = rowA.cells[cellIndex].textContent.trim();
                const textB = rowB.cells[cellIndex].textContent.trim();
                
                // Sayƒ±sal deƒüerleri √ßƒ±kar
                valueA = parseFloat(textA.replace(/[\$,+%]/g, '')) || 0;
                valueB = parseFloat(textB.replace(/[\$,+%]/g, '')) || 0;
                
                // Hacim i√ßin √∂zel i≈ülem (K, M birimleri)
                if (col === 'vol') {
                    if (textA.includes('M')) valueA *= 1000000;
                    else if (textA.includes('K')) valueA *= 1000;
                    if (textB.includes('M')) valueB *= 1000000;
                    else if (textB.includes('K')) valueB *= 1000;
                }

                // Kar≈üƒ±la≈ütƒ±rma sonucu
                const result = valueA - valueB;
                return sortData.dir === 'asc' ? result : -result;
            });

            // Sƒ±ralanmƒ±≈ü satƒ±rlarƒ± tabloya geri yerle≈ütir
            tbody.innerHTML = '';
            rows.forEach(row => tbody.appendChild(row));
        }

        function addCoin() {
            let s = $('coinInput').value.trim().toUpperCase();
            if (!s) return alert('L√ºtfen bir coin adƒ± girin!');
            
            if (!s.endsWith('USDT')) s += 'USDT';
            
            if (coins[s]) return alert(`${s} zaten takip ediliyor!`);

            if (Object.keys(coins).length >= 20) {
                return alert('Maksimum 20 coin takip edebilirsiniz!');
            }

            coins[s] = { ws: null, last: 0 };
            updateUI();
            connect(s);
            save();
            $('coinInput').value = '';
        }

        function remove(s) {
            if (coins[s]) {
                if (coins[s].ws) coins[s].ws.close();
                delete coins[s];
                $(`row-${s}`).remove();
                save();
                if (Object.keys(coins).length === 0) updateUI();
            }
        }

        $('coinInput').onkeypress = (e) => {
            if (e.key === 'Enter') addCoin();
        };

        window.onload = () => {
            if (load()) {
                updateUI();
                Object.keys(coins).forEach(connect);
            }
        };

        window.onbeforeunload = () => {
            Object.values(coins).forEach(c => c.ws?.close());
        };
    </script>
</body>
</html>
